!function(){angular.module("connect4",["ngRoute","ui.router","ui.bootstrap","angularMoment"])}(),function(){angular.module("connect4").config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/home"),$stateProvider.state("test",{url:"/test",templateUrl:"src/views/test.html",controller:"TestController",data:{pageTitle:"Test View"}}).state("players",{url:"/players",templateUrl:"src/views/players.html",controller:"PlayersController",data:{pageTitle:"Players"}}).state("game",{url:"/game",templateUrl:"src/views/connect4.html",controller:"GameController",data:{pageTitle:"Game"}})}).run(function($rootScope){$rootScope.$on("$viewContentLoaded",function(){})})}(),function(){angular.module("connect4").config(["$httpProvider",function($httpProvider){delete $httpProvider.defaults.headers.common["X-Requested-With"]}])}(),angular.module("connect4").controller("GameController",function($scope,$location,$modal,GameRulesService,PlayerFactory,MoveFactory){function showReplayModal(){var modalInstance=$modal.open({templateUrl:"src/views/partials/replay.html",controller:"ReplayGameController"});modalInstance.result.then(function(){},function(){})}$scope.players=PlayerFactory.players,$scope.matrix=[],$scope.currentPlayer=null;for(var i=5;i>=0;i--){$scope.matrix[i]=[];for(var j=6;j>=0;j--)$scope.matrix[i][j]={available:!0,line:i,column:j}}$scope.updateLowestPiece=function(line,column){for(var i=$scope.matrix.length-1;i>=line;i--)for(var j=6;j>=0;j--)if(j===column&&$scope.matrix[i][j].available){var move={player:$scope.getCurrentPlayer(),position:{line:i,column:j}};MoveFactory.addMove(move),$scope.matrix[i][j].move=move,$scope.matrix[i][j].available=!1;var findWinnerMove=GameRulesService.findWinnerMove($scope.matrix);return void(findWinnerMove&&findWinnerMove.hasWinner?($scope.showWinnerMove(findWinnerMove.moves),$scope.winner=findWinnerMove.winner):$scope.switchPlayer())}},$scope.showWinnerMove=function(moves){for(var i=moves.length-1;i>=0;i--){var move=moves[i];move.winnerMove=!0,$scope.matrix[move.position.line][move.position.column].move=move}},$scope.deletePiece=function(move){null!==move&&($scope.matrix[move.position.line][move.position.column].available=!0,$scope.matrix[move.position.line][move.position.column].move=null)},$scope.isReady=function(){return $scope.players.player1.ready&&$scope.players.player2.ready?!0:void 0},$scope.startGame=function(){$scope.currentPlayer=Math.floor(2*Math.random())+1===1?$scope.players.player2:$scope.players.player1},$scope.getCurrentPlayer=function(){return $scope.currentPlayer},$scope.isCurrentPlayer=function(player){return $scope.getCurrentPlayer()===player},$scope.switchPlayer=function(){$scope.currentPlayer=$scope.currentPlayer===$scope.players.player1?$scope.players.player2:$scope.players.player1},$scope.undo=function(){var move=MoveFactory.undoMove();$scope.deletePiece(move),$scope.switchPlayer()},$scope.replay=function(){showReplayModal()},$scope.isReady()?$scope.startGame():$location.path("/players")}),angular.module("connect4").controller("MainController",function($scope,$state){$scope.authBackground=$state.includes("dashboards")}),angular.module("connect4").controller("PlayersController",function($scope,$location,PlayerFactory){$scope.players=PlayerFactory.players,$scope.isReady=function(){return $scope.players.player1.ready&&$scope.players.player2.ready?!0:void 0},$scope.validatePlayer=function(player){""!==player.nickname&&""!==player.color?player.ready=!0:(player.errorMessage="Please inform your nickname and select your color",player.hasError=!0)},$scope.$watch("players",function(){$scope.isReady()&&$location.path("/game")},!0)}),angular.module("connect4").controller("ReplayGameController",function($scope,$location,GameRulesService,PlayerFactory,MoveFactory){$scope.players=PlayerFactory.players,$scope.moves=MoveFactory.getMoves(),$scope.matrix=[],$scope.speed=2e3,$scope.currentPlayer=null;for(var i=5;i>=0;i--){$scope.matrix[i]=[];for(var j=6;j>=0;j--)$scope.matrix[i][j]={available:!0,line:i,column:j}}$scope.play=function(){$scope.playing=!0;var move=null;!function next(counter,maxLoops,speed){return counter++>=maxLoops?($scope.playing=!1,void $scope.$apply()):void window.setTimeout(function(){move=$scope.moves[counter],$scope.matrix[move.position.line][move.position.column].move=move,$scope.$apply(),next(counter,maxLoops,speed)},speed)}(-1,$scope.moves.length-1,$scope.speed)},$scope.showWinnerMove=function(moves){for(var i=0;i<moves.length;i++){var move=moves[i];move.winnerMove=!0,$scope.matrix[move.position.line][move.position.column].move=move}},$scope.deletePiece=function(move){null!==move&&($scope.matrix[move.position.line][move.position.column].available=!0,$scope.matrix[move.position.line][move.position.column].move=null)},$scope.replay=function(){for(var i=$scope.matrix.length-1;i>=0;i--)for(var j=$scope.matrix[i].length-1;j>=0;j--)delete $scope.matrix[i][j].move;$scope.play()},$scope.play()}),angular.module("connect4").controller("TestController",function($scope){$scope.connect="Connect"}),function(){angular.module("connect4").directive("animationPiece",function(){return{restrict:"AE",replace:"true",template:"<div class='piece' ng-class=''></div>",scope:{item:"@"},link:function(scope,el){function render(){var evalItem=scope.$eval(scope.item);evalItem.available||($(el).addClass("selected"),$(el).css({backgroundColor:evalItem.player.color}))}scope.$watch("item",function(newValue,oldValue){console.log(newValue),console.log(oldValue),render()})}}})}(),function(){angular.module("connect4").directive("countUp",function(){return{restrict:"A",scope:{value:"@",prefix:"@",suffix:"@"},link:function(scope,elem){var options={useEasing:!0,useGrouping:!0,separator:".",decimal:",",prefix:scope.prefix||"",suffix:scope.suffix||""};scope.$watch("value",function(newVal){var count=new countUp(elem,0,parseFloat(newVal),2,2,options);count.start()})}}})}(),function(){angular.module("connect4").directive("ngMoment",function(){return{restrict:"A",scope:{value:"@",parse:"@",format:"@",locale:"@"},link:function(scope,elem){window.moment.locale(scope.locale||"pt-br"),scope.value?$(elem).html(scope.parse?window.moment(scope.value,scope.parse).format(scope.format):window.moment(scope.value).format(scope.format)):window.setInterval(function(){$(elem).html(window.moment().format(scope.format))},1e3)}}})}(),function(){angular.module("connect4").directive("pageTitle",function($rootScope,$timeout){return{link:function(scope,element){var listener=function(event,toState){var title="connect4 | ";toState.data&&toState.data.pageTitle&&(title="connect4 | "+toState.data.pageTitle),$timeout(function(){element.text(title)})};$rootScope.$on("$stateChangeStart",listener)}}})}(),function(){angular.module("connect4").directive("piece",function(){return{restrict:"AE",replace:"true",template:"<div class='piece' ng-class=''></div>",scope:{model:"@"},link:function(scope,el){function createAnimatedPiece(){var evalModel=scope.$eval(scope.model),div=window.document.createElement("div");$(div).addClass("piece animated"),$(div).css({top:-1*$(el).offset().top,opacity:0,backgroundColor:evalModel.move.player.color}),$(el).append(div),$(div).animate({top:0,opacity:1},500,function(){render()})}function render(){var evalModel=scope.$eval(scope.model);evalModel.available||($(el).addClass("selected"),$(el).css({backgroundColor:evalModel.move.player.color})),$(".piece.animated").remove()}function removePiece(){var div=window.document.createElement("div");$(div).addClass("piece animated"),$(div).css({backgroundColor:$(el).css("backgroundColor")}),$(el).append(div),$(el).removeClass("selected"),$(el).css({backgroundColor:"transparent"}),$(div).animate({top:-1*$(el).offset().top,opacity:0},500,function(){})}function renderWinnerMove(){var evalModel=scope.$eval(scope.model),div=window.document.createElement("div");$(div).addClass("piece winnerMove"),$(el).append(div),$(el).addClass("selected"),$(el).css({backgroundColor:evalModel.move.player.color})}scope.$watch("model",function(newValue,oldValue){if(newValue!==oldValue){var evalModel=scope.$eval(scope.model);null===evalModel.move?removePiece():evalModel.move.winnerMove?renderWinnerMove():createAnimatedPiece()}})}}})}(),function(){angular.module("connect4").directive("pieceReplay",function(){return{restrict:"AE",replace:"true",template:"<div class='piece' ng-class=''></div>",scope:{model:"@"},link:function(scope,el){function createAnimatedPiece(){var evalModel=scope.$eval(scope.model),div=window.document.createElement("div");$(div).addClass("piece animated"),$(div).css({top:-1*$(el).offset().top,opacity:0,backgroundColor:evalModel.move.player.color}),$(el).append(div),$(div).animate({top:0,opacity:1},500,function(){render()})}function render(){var evalModel=scope.$eval(scope.model);evalModel.move&&($(el).addClass("selected"),$(el).css({backgroundColor:evalModel.move.player.color})),$(".piece.animated").remove()}function reset(){$(el).removeClass("selected"),$(el).css({backgroundColor:"transparent"})}scope.$watch("model",function(newValue,oldValue){if(newValue!==oldValue){var evalModel=scope.$eval(scope.model);evalModel.move?createAnimatedPiece():reset()}})}}})}(),function(){angular.module("connect4").directive("winner",function(){return{restrict:"AE",replace:"true",templateUrl:"/src/views/partials/winner.html",link:function(scope){scope.$watch("winner",function(newValue,oldValue){console.log(newValue),console.log(oldValue)})}}})}(),function(){angular.module("connect4").factory("AuthUsers",function($http,$location,SessionControll){var cacheSession=function(user){SessionControll.set("userLogin",!0),SessionControll.set("user",user)},unCacheSession=function(){SessionControll.unset("userLogin"),SessionControll.unset("user")};return{login:function(user){return $http({url:"login/validateLogin",method:"POST",cache:!1,data:"email="+user.email+"&password="+user.password+"&datetime="+(new Date).getTime(),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){data.status===!0&&cacheSession(JSON.stringify(data.user))}).error(function(){})},logout:function(){return $http({url:"/login/logout/?t="+(new Date).getTime()}).success(function(){unCacheSession(),$location.path("/login")})},isLoggedIn:function(){return SessionControll.get("userLogin")}}})}(),function(){angular.module("connect4").factory("MoveFactory",function(){var moves=[];return{addMove:function(move){moves.push(move)},undoMove:function(){if(moves.length>0){var move=moves[moves.length-1];return moves.pop(),move}return null},forwardMove:function(){},getMoves:function(){return moves},getMovesByPlayer:function(player){for(var playerMoves=[],i=moves.length-1;i>=0;i--)moves[i].player.nickname===player.nickname&&playerMoves.push(moves[i]);return playerMoves}}})}(),function(){angular.module("connect4").factory("PlayerFactory",function(){return{players:{player1:{nickname:"Diego",color:"#00aa66",ready:!1},player2:{nickname:"Cassia",color:"#995500",ready:!1}}}})}(),function(){angular.module("connect4").factory("SessionControll",function(){return{get:function(key){return window.sessionStorage.getItem(key)},set:function(key,val){return window.sessionStorage.setItem(key,val)},unset:function(key){return window.sessionStorage.removeItem(key)}}})}(),function(){"use strict";angular.module("connect4").service("GameRulesService",function(){function defaultReturns(count,movesList){return 4===count?{hasWinner:!0,moves:movesList,winner:movesList[0].player}:{hasWinner:!1}}function validateHorizontally(){function right2Left(piece){var count=1,movesList=[];if(piece.column>=3){movesList.push(piece.move);for(var i=1;3>=i;i++)if(!matrix[piece.line][piece.column-i].available){if(piece.move.player.nickname!==matrix[piece.line][piece.column-i].move.player.nickname)break;movesList.push(matrix[piece.line][piece.column-i].move),count++}}return defaultReturns(count,movesList)}for(var i=matrix.length-1;i>=0;i--)for(var j=matrix[i].length-1;j>=0;j--)if(!matrix[i][j].available){var result=right2Left(matrix[i][j]);if(result.hasWinner)return result}}function validateVertically(){function verticalBottom2Top(piece){var count=1,movesList=[];if(piece.line>=3)for(var i=1;3>=i;i++)if(movesList.push(piece.move),!matrix[piece.line-i][piece.column].available){if(piece.move.player.nickname!==matrix[piece.line-i][piece.column].move.player.nickname)break;movesList.push(matrix[piece.line-i][piece.column].move),count++}return defaultReturns(count,movesList)}for(var i=matrix.length-1;i>=0;i--)for(var j=matrix[i].length-1;j>=0;j--)if(!matrix[i][j].available){var result=verticalBottom2Top(matrix[i][j]);if(result.hasWinner)return result}}function validateDiagonally(){function diagonalBottomLeft(piece){var count=1,movesList=[];if(piece.line>=3&&piece.column>=3)for(var i=1;3>=i;i++)if(movesList.push(piece.move),!matrix[piece.line-i][piece.column-i].available){if(piece.move.player.nickname!==matrix[piece.line-i][piece.column-i].move.player.nickname)break;movesList.push(matrix[piece.line-i][piece.column-i].move),count++}return defaultReturns(count,movesList)}function diagonalBottomRight(piece){var count=1,movesList=[];if(piece.line>=3&&piece.column<=3){movesList.push(piece.move);for(var i=1;3>=i;i++)if(!matrix[piece.line-i][piece.column+i].available){if(piece.move.player.nickname!==matrix[piece.line-i][piece.column+i].move.player.nickname)break;movesList.push(matrix[piece.line-i][piece.column+i].move),count++}}return defaultReturns(count,movesList)}for(var i=matrix.length-1;i>=0;i--)for(var j=matrix[i].length-1;j>=0;j--)if(!matrix[i][j].available){var result=diagonalBottomLeft(matrix[i][j]);if(result.hasWinner)return result;if(result=diagonalBottomRight(matrix[i][j]),result.hasWinner)return result}}var matrix=null;this.findWinnerMove=function(_matrix){matrix=_matrix;var checkHorizontally=validateHorizontally(),checkVertically=validateVertically(),checkDiagonally=validateDiagonally();return checkHorizontally&&checkHorizontally.hasWinner?checkHorizontally:checkVertically&&checkVertically.hasWinner?checkVertically:checkDiagonally&&checkDiagonally.hasWinner?checkDiagonally:void 0}})}();